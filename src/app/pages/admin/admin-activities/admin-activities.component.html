<div class="admin-activities-container">
  <div class="header">
    <h1>
      <span>üìù</span>
      Gestion des Activit√©s
    </h1>
    <button class="btn-primary" (click)="openCreateModal()">
      <span>+</span> Cr√©er une activit√©
    </button>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading()" class="loading-spinner">
    <div class="spinner"></div>
    <p>Chargement...</p>
  </div>

  <!-- Activities Table -->
  <div class="activities-table" *ngIf="!loading()">
    <div class="table-header">
      <span class="col-image">Image</span>
      <span class="col-title">Titre</span>
      <span class="col-category">Cat√©gorie</span>
      <span class="col-date">Date</span>
      <span class="col-actions">Actions</span>
    </div>

    <div class="table-body">
      <div class="table-row" *ngFor="let activity of activities()">
        <div class="col-image">
          <img [src]="activity.image" [alt]="activity.title">
        </div>
        <div class="col-title">
          <h3>{{ activity.title }}</h3>
          <p>{{ activity.shortDescription }}</p>
        </div>
        <div class="col-category">
          <span class="badge">{{ activity.category }}</span>
        </div>
        <div class="col-date">
          {{ activity.date ? (activity.date | date:'dd/MM/yyyy') : 'N/A' }}
        </div>
        <div class="col-actions">
          <button class="btn-edit" (click)="openEditModal(activity)" title="Modifier">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
          <button class="btn-delete" (click)="deleteActivity(activity)" title="Supprimer">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
          </button>
        </div>
      </div>

      <div class="empty-state" *ngIf="activities().length === 0">
        <p>Aucune activit√© trouv√©e</p>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pagination" *ngIf="totalPages() > 1">
    <button class="btn-page" (click)="previousPage()" [disabled]="currentPage() === 1">
      Pr√©c√©dent
    </button>
    
    <button 
      *ngFor="let page of pages" 
      class="btn-page" 
      [class.active]="page === currentPage()"
      (click)="goToPage(page)">
      {{ page }}
    </button>
    
    <button class="btn-page" (click)="nextPage()" [disabled]="currentPage() === totalPages()">
      Suivant
    </button>
    
    <span class="page-info">
      Total: {{ totalItems() }} activit√©(s)
    </span>
  </div>

  <!-- Modal for Create/Edit -->
  <div class="modal-overlay" *ngIf="showModal()" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditMode() ? 'Modifier l\'activit√©' : 'Cr√©er une activit√©' }}</h2>
        <button class="btn-close" (click)="closeModal()">√ó</button>
      </div>

      <form [formGroup]="activityForm" (ngSubmit)="onSubmit()" class="modal-body">
        <div class="form-grid">
          <!-- Title -->
          <div class="form-group full-width">
            <label for="title">Titre *</label>
            <input 
              type="text" 
              id="title" 
              formControlName="title" 
              placeholder="Titre de l'activit√©">
            <span class="error" *ngIf="activityForm.get('title')?.touched && activityForm.get('title')?.errors">
              Le titre est requis (min. 3 caract√®res)
            </span>
          </div>

          <!-- Category -->
          <div class="form-group">
            <label for="category">Cat√©gorie *</label>
            <select id="category" formControlName="category">
              <option value="">S√©lectionner une cat√©gorie</option>
              <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
            </select>
            <span class="error" *ngIf="activityForm.get('category')?.touched && activityForm.get('category')?.errors">
              La cat√©gorie est requise
            </span>
          </div>

          <!-- Date -->
          <div class="form-group">
            <label for="date">Date</label>
            <input type="date" id="date" formControlName="date">
          </div>

          <!-- Location -->
          <div class="form-group">
            <label for="location">Lieu</label>
            <input 
              type="text" 
              id="location" 
              formControlName="location" 
              placeholder="Lieu de l'activit√©">
          </div>

          <!-- Author -->
          <div class="form-group">
            <label for="author">Auteur</label>
            <input 
              type="text" 
              id="author" 
              formControlName="author" 
              placeholder="Nom de l'auteur">
          </div>

          <!-- Short Description -->
          <div class="form-group full-width">
            <label for="shortDescription">Description courte *</label>
            <textarea 
              id="shortDescription" 
              formControlName="shortDescription" 
              rows="2"
              placeholder="Description courte (min. 10 caract√®res)"></textarea>
            <span class="error" *ngIf="activityForm.get('shortDescription')?.touched && activityForm.get('shortDescription')?.errors">
              La description courte est requise (min. 10 caract√®res)
            </span>
          </div>

          <!-- Description -->
          <div class="form-group full-width">
            <label for="description">Description compl√®te *</label>
            <textarea 
              id="description" 
              formControlName="description" 
              rows="6"
              placeholder="Description compl√®te de l'activit√© (min. 50 caract√®res)"></textarea>
            <span class="error" *ngIf="activityForm.get('description')?.touched && activityForm.get('description')?.errors">
              La description est requise (min. 50 caract√®res)
            </span>
          </div>

          <!-- Partners -->
          <div class="form-group full-width">
            <label for="partners">Partenaires</label>
            <input 
              type="text" 
              id="partners" 
              formControlName="partners" 
              placeholder="S√©parer par des points-virgules (ex: Partner1;Partner2)">
            <small>S√©parez les partenaires par des points-virgules</small>
          </div>

          <!-- Related Activities -->
          <div class="form-group full-width">
            <label for="relatedActivities">Activit√©s li√©es</label>
            <input 
              type="text" 
              id="relatedActivities" 
              formControlName="relatedActivities" 
              placeholder="Slugs des activit√©s li√©es s√©par√©s par des points-virgules">
            <small>S√©parez les slugs par des points-virgules</small>
          </div>

          <!-- Main Image -->
          <div class="form-group full-width">
            <label for="image">Image principale {{ isEditMode() ? '' : '*' }}</label>
            <input 
              type="file" 
              id="image" 
              accept="image/*"
              (change)="onImageSelect($event)">
            <div class="image-preview" *ngIf="imagePreview">
              <img [src]="imagePreview" alt="Preview">
            </div>
          </div>

          <!-- Gallery -->
          <div class="form-group full-width">
            <label for="gallery">Galerie d'images</label>
            <input 
              type="file" 
              id="gallery" 
              accept="image/*"
              multiple
              (change)="onGallerySelect($event)">
            <small>{{ galleryFiles.length }} fichier(s) s√©lectionn√©(s)</small>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" (click)="closeModal()">
            Annuler
          </button>
          <button type="submit" class="btn-primary" [disabled]="loading()">
            {{ loading() ? 'Enregistrement...' : (isEditMode() ? 'Mettre √† jour' : 'Cr√©er') }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
